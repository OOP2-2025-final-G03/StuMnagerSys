{% extends active_template %} {% block extra_css %}
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/list.css') }}"
/>

<style>
  /* --- ご提示のスタイルを完全に維持 --- */
  .category {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 6px;
    font-size: 0.75rem;
    font-weight: 500;
  }
  .category-required {
    background-color: rgba(249, 115, 22, 0.1);
    color: #c2410c;
  }
  [data-theme="dark"] .category-required {
    color: #fb923c;
  }
  .category-elective {
    background-color: rgba(14, 165, 233, 0.1);
    color: #0284c7;
  }
  [data-theme="dark"] .category-elective {
    color: #38bdf8;
  }
  .credit-num {
    font-weight: 600;
    color: var(--text-main);
  }

  /* --- 修正後 --- */
  .list-card {
    width: 100%;
    max-width: 100%;
    box-sizing: border-box;
  }
  /* もし画面全体が動かない場合はこちらも確認 */
  html,
  body {
    overflow-y: auto !important;
    height: auto !important;
  }

  .list-actions {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 8px;
    margin-bottom: 20px;
    flex-wrap: wrap;
    width: 100%;
    box-sizing: border-box;
  }
  .search-box {
    display: flex;
    align-items: center;
    gap: 6px;
    flex: 1;
    min-width: 0;
  }
  .search-box input {
    height: 36px;
    padding: 0 10px;
    border-radius: 6px;
    border: 1px solid var(--border-color);
    background-color: var(--input-bg);
    color: var(--text-main);
    flex: 1;
    min-width: 0;
    width: 100%;
    box-sizing: border-box;
  }

  .btn-search {
    flex-shrink: 1;
    white-space: normal;
    padding: 0 10px;
    appearance: none;
    cursor: pointer;
    height: 36px;
    font-size: 13px;
    font-weight: 600;
    color: #ffffff;
    background-color: var(--primary-color);
    border-radius: 8px;
    border: none;
  }
  .btn-add {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    height: auto;
    min-height: 36px;
    padding: 8px 16px;
    background-color: var(--primary-color);
    color: white;
    text-decoration: none;
    border-radius: 8px;
    font-weight: 600;
    font-size: 0.875rem;
    white-space: normal;
    text-align: center;
    line-height: 1.2;
    flex-shrink: 1;
    max-width: 100%;
    box-sizing: border-box;
    transition: all var(--anim-fast);
  }

  /* 履修管理ボタン用スタイル追加 */
  .btn-manage {
    background-color: #6366f1;
    color: white;
    padding: 4px 10px;
    border-radius: 6px;
    text-decoration: none;
    font-size: 0.75rem;
    font-weight: 600;
    display: inline-block;
    margin-bottom: 4px;
  }

  @media (max-width: 500px) {
    .list-actions {
      flex-direction: column;
      align-items: stretch;
    }
    .btn-add {
      order: -1;
      width: 100%;
    }
    .search-box {
      width: 100%;
    }
  }
  .table-responsive {
    width: 100%;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }
</style>
{% endblock %} {% block page_title %}科目管理{% endblock %} {% block
main_content %}
<div class="list-card">
  <div class="list-header">
    <h2>{{ title }}</h2>
    <p>カリキュラムや担当教員、単位数を管理します。</p>
  </div>

  {% set current_category = request.args.get('category', 'all') %}
  <div class="filter-tabs">
    <a
      href="{{ url_for('subject.list', category='all', role=role) }}"
      class="filter-tab {{ 'active' if current_category == 'all' else '' }}"
      >すべて</a
    >
    <a
      href="{{ url_for('subject.list', category='required', role=role) }}"
      class="filter-tab {{ 'active' if current_category == 'required' else '' }}"
      >必修科目</a
    >
    <a
      href="{{ url_for('subject.list', category='elective', role=role) }}"
      class="filter-tab {{ 'active' if current_category == 'elective' else '' }}"
      >選択科目</a
    >
  </div>

  <div class="list-actions">
    <form
      method="get"
      action="{{ url_for('subject.subject_list') }}"
      class="search-box"
    >
      <input type="hidden" name="role" value="{{ role }}" />
      <input
        type="text"
        name="keyword"
        placeholder="科目名・専攻で検索..."
        value="{{ request.args.get('keyword', '') }}"
      />
      <button type="submit" class="btn-search">検索</button>
    </form>
    {% if role in ['admin', 'teacher'] %}
    <a href="{{ url_for('subject.create') }}" class="btn-add">新規科目</a>
    {% endif %}
  </div>

  <div class="table-responsive">
    <table class="styled-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>科目名</th>
          <th>専攻</th>
          <th>区分</th>
          <th>対象学年</th>
          <th>単位数</th>
          <th>開講日時</th>
          <th>操作</th>
        </tr>
      </thead>
      <tbody>
        {% if subjects|length > 0 %} {% for sub in subjects %}
        <tr>
          <td style="font-family: monospace">{{ sub.id }}</td>
          <td style="font-weight: 500; color: var(--text-main)">
            {{ sub.name }}
          </td>
          <td>{{ sub.major }}</td>
          <td>
            <span
              class="category {{ 'category-required' if sub.category == 'required' else 'category-elective' }}"
              >{{ '必修' if sub.category == 'required' else '選択' }}</span
            >
          </td>
          <td>{{ sub.grade }} 年</td>
          <td><span class="credit-num">{{ sub.credits }}</span> 単位</td>
          <td>{{ sub.day }} {{ sub.period }}限</td>
          <td>
            <div class="action-buttons">
              <a
                href="{{ url_for('subject.manage', subject_id=sub.id, role=role) }}"
                class="btn-manage"
                >履修管理</a
              >
              <a
                href="{{ url_for('subject.edit', subject_id=sub.id) }}"
                class="action-link edit-link"
                >編集</a
              >
              <a
                href="{{ url_for('subject.delete', subject_id=sub.id) }}"
                class="action-link delete-link"
                onclick="return confirm('本当に削除しますか？');"
                >削除</a
              >
            </div>
          </td>
        </tr>
        {% endfor %} {% else %}
        <tr>
          <td
            colspan="8"
            style="text-align: center; padding: 40px; color: #94a3b8"
          >
            データが見つかりませんでした。
          </td>
        </tr>
        {% endif %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}