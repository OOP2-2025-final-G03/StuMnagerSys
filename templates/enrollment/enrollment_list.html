{% extends "dashboard/student.html" %} {% block title %}マイ履修科目 |
学生管理システム{% endblock %} {% block page_title %}履修科目{% endblock %} {%
block extra_css %}
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/list.css') }}"
/>
<style>
  .category {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 6px;
    font-size: 0.75rem;
    font-weight: 500;
  }
  .category-required {
    background-color: rgba(249, 115, 22, 0.1);
    color: #c2410c;
  }
  .category-elective {
    background-color: rgba(14, 165, 233, 0.1);
    color: #0284c7;
  }
</style>
{% endblock %} {% block main_content %}
<div class="list-card">
  <div class="list-header">
    <h2>マイ履修科目一覧</h2>
    <p>現在の履修スケジュールです。</p>
  </div>

  <div class="table-responsive" id="scroll-container">
    <table class="styled-table">
      <thead>
        <tr>
          <th>科目名</th>
          <th>区分</th>
          <th>単位数</th>
          <th>開講日時</th>
        </tr>
      </thead>
      <tbody id="enrollment-table-body">
        {% if subjects|length > 0 %} 
            {% include 'enrollment/enrollment_rows.html' %}
        {% else %}
        <tr>
          <td
            colspan="4"
            style="text-align: center; padding: 40px; color: var(--text-sub)"
          >
            現在、履修登録されている科目はありません。
          </td>
        </tr>
        {% endif %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
let offset = 50;
let loading = false;
let hasMore = {{ 'true' if has_more else 'false' }};

const container = document.getElementById('scroll-container');
const tbody = document.getElementById('enrollment-table-body');

container.addEventListener('scroll', async () => {
    if (!hasMore || loading) return;

    if (container.scrollTop + container.clientHeight >= container.scrollHeight - 10) {
        loading = true;

        // URLパラメータ生成
        const params = new URLSearchParams({
            offset: offset
        });

        const res = await fetch(
            `{{ url_for('enrollments.index') }}?${params.toString()}`,
            { headers: { 'X-Requested-With': 'XMLHttpRequest' } }
        );

        const html = await res.text();

        if (!html.trim()) {
            hasMore = false;
            return;
        }

        tbody.insertAdjacentHTML('beforeend', html);
        offset += 50;
        loading = false;
    }
});
</script>
{% endblock %}
